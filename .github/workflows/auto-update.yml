name: Update Lottery Data

on:
  schedule:
    # 每周一、三、六 UTC 13:00 (北京时间 21:00)
    - cron: '0 13 * * 1,3,6'
  workflow_dispatch:  # 允许手动触发

jobs:
  update-data:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests
      
      - name: Create data directory
        run: |
          mkdir -p data/raw
      
      - name: Run data collector (strict mode)
        run: |
          python scripts/collect_real_data.py
      
      - name: Commit and push data
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add data/raw/
          git diff --quiet && git diff --staged --quiet || (git commit -m "chore: Auto-update lottery data [$(date +'%Y-%m-%d %H:%M:%S')]" && git push)
```

---

### Step 3: 手动触发测试

1. **访问 Actions 页面**
```
   https://github.com/Baggio200cn/Large-model-post-training/actions
```

2. **选择工作流**
   - 点击 **"Update Lottery Data"**

3. **手动触发**
   - 点击右侧的 **"Run workflow"** 按钮
   - 选择分支 `main`
   - 点击绿色的 **"Run workflow"** 按钮

4. **查看运行日志**
   - 等待运行完成（约1-2分钟）
   - 点击运行的任务查看详细日志

---

### Step 4: 预期的运行结果

#### ✅ 成功情况：
```
================================================================================
🎯 大乐透数据采集工具 v3.0 - 严格模式
================================================================================
📌 策略: 只接受真实数据，不生成模拟数据
📌 来源: 中国福利彩票官方API

✅ 数据采集器初始化完成（严格模式）

📡 正在从官方API获取最近 100 期数据...
   API地址: http://www.cwl.gov.cn/...
   发送请求...
   收到响应: HTTP 200
   解析数据...

✅ 成功获取 100 期真实数据

📊 数据质量验证（前5期）:
--------------------------------------------------------------------------------
第1期: 25126 | 2025-10-29 (周三) ✅
      红球: [3, 7, 12, 18, 25] | 蓝球: [4, 11]
第2期: 25125 | 2025-10-27 (周一) ✅
      红球: [5, 10, 16, 22, 33] | 蓝球: [2, 9]
...

✅ 数据已保存: data/raw/history.json
✅ 共保存 100 期真实数据

📊 最新一期:
   期号: 25126
   日期: 2025-10-29
   红球: [3, 7, 12, 18, 25]
   蓝球: [4, 11]

================================================================================
🎉 数据采集成功！
================================================================================

✅ 采集了 100% 真实的官方数据
✅ 数据将自动提交到 GitHub
✅ Vercel 将自动部署到网站

💡 提示: 网站只显示真实开奖数据，绝无模拟
```

#### ❌ 失败情况：
```
================================================================================
🎯 大乐透数据采集工具 v3.0 - 严格模式
================================================================================

📡 正在从官方API获取最近 100 期数据...
   API地址: http://www.cwl.gov.cn/...
   发送请求...
❌ 网络连接失败
   可能原因：无网络连接或DNS解析失败

================================================================================
❌ 数据采集失败
================================================================================

可能的原因:
  1. 网络连接问题
  2. 官方API服务不可用
  3. API接口发生变更
  4. 请求被拒绝或限流

建议:
  - 检查网络连接
  - 稍后重试
  - 查看完整错误日志

⚠️  注意: 本程序采用严格模式，不会生成模拟数据
